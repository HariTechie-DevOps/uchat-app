<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sign Up</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
}

.container {
  width: 360px;
  margin: 40px auto;
  background: #fff;
  padding: 25px;
  border-radius: 6px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}

.input-group {
  display: flex;
}

select, input {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

select {
  width: 35%;
  margin-right: 6px;
}

input.invalid, select.invalid {
  border-color: red;
}

.error {
  color: red;
  font-size: 12px;
  margin-top: 4px;
  display: none;
}

.actions {
  margin-top: 20px;
  text-align: center;
}

button {
  width: 100%;
  padding: 10px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 15px;
}

button:disabled {
  background: #aaa;
  cursor: not-allowed;
}

.signin {
  margin-top: 12px;
  font-size: 14px;
}

.signin a {
  color: #007bff;
  text-decoration: none;
  font-weight: 600;
}

.signin a:hover {
  text-decoration: underline;
}
</style>
</head>

<body>

<div class="container">
  <h2>Sign Up</h2>

  <label>Name</label>
  <input id="name">
  <div class="error" id="nameError"></div>

  <label>Age</label>
  <input id="age" type="number">
  <div class="error" id="ageError"></div>

  <label>Gender</label>
  <select id="gender">
    <option value="">Select</option>
    <option>Male</option>
    <option>Female</option>
  </select>
  <div class="error" id="genderError"></div>

  <label>Mobile</label>
  <div class="input-group">
    <select id="code">
      <option value="+91">+91</option>
      <option value="+1">+1</option>
      <option value="+44">+44</option>
    </select>
    <input id="mobile" maxlength="15">
  </div>
  <div class="error" id="mobileError"></div>

  <label>Password</label>
  <input id="password" type="password">
  <div class="error" id="passwordError"></div>

  <div class="actions">
    <button id="signupBtn" onclick="signup()">Sign Up</button>

    <div class="signin">
      Already have an account?
      <a href="#" onclick="openSignin()">Sign In</a>
    </div>
  </div>
</div>

<script>
// Make sure this matches your current EC2 Public IP exactly!
const API_BASE = "http://13.233.141.130:8080";

function clearErrors() {
  document.querySelectorAll(".error").forEach(e => {
    e.style.display = "none";
    e.innerText = "";
  });
  document.querySelectorAll("input, select").forEach(e => {
    e.classList.remove("invalid");
  });
}

function showError(field, message) {
  const input = document.getElementById(field);
  const error = document.getElementById(field + "Error");

  if (input) input.classList.add("invalid");
  if (error) {
    error.innerText = message;
    error.style.display = "block";
  }
}

document.getElementById("mobile").addEventListener("input", e => {
  e.target.value = e.target.value.replace(/\D/g, "");
});

function signup() {
  clearErrors();

  const name = document.getElementById("name").value.trim();
  const age = document.getElementById("age").value;
  const gender = document.getElementById("gender").value;
  const mobileOnly = document.getElementById("mobile").value.trim();
  const mobile = document.getElementById("code").value + mobileOnly;
  const password = document.getElementById("password").value;

  let invalid = false;

  if (!/^[A-Za-z ]{3,}$/.test(name)) {
    showError("name", "Enter valid name (min 3 letters)");
    invalid = true;
  }

  if (!age || age < 18 || age > 100) {
    showError("age", "Age must be between 18 and 100");
    invalid = true;
  }

  if (!gender) {
    showError("gender", "Select gender");
    invalid = true;
  }

  if (!/^[0-9]{7,15}$/.test(mobileOnly)) {
    document.getElementById("mobile").classList.add("invalid");
    document.getElementById("code").classList.add("invalid");
    document.getElementById("mobileError").innerText = "Enter valid mobile number";
    document.getElementById("mobileError").style.display = "block";
    invalid = true;
  }

  if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/.test(password)) {
    showError("password", "Password must be strong");
    invalid = true;
  }

  if (invalid) return;

  const btn = document.getElementById("signupBtn");
  btn.disabled = true;
  btn.innerText = "Signing up...";

  fetch(`${API_BASE}/api/signup`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, age, gender, mobile, password })
  })
  .then(res => res.json())
  .then(data => {
    if (!data.success) {
        if (data.field) {
            showError(data.field, data.message);
        } else {
            alert("Error: " + data.message);
        }
        
        btn.disabled = false;
        btn.innerText = "Sign Up";
        return;
    }
    alert("Signup successful!");
    window.location.href = "signin.html";
  })
  .catch(() => {
    alert("Backend not reachable");
    btn.disabled = false;
    btn.innerText = "Sign Up";
  });
}

function openSignin() {
    window.location.href = "signin.html";
}
</script>

</body>
</html>
